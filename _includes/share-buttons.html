<div class="mt-6 border p-4 rounded bg-yellow-50 max-w-sm">
  <label for="zap-amount" class="block mb-2 text-sm font-medium text-gray-700">
    üí∏ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Zap (sats):
  </label>
  <input id="zap-amount" type="number" min="1" step="1" value="100"
         class="w-full p-2 border rounded mb-3">

  <button onclick="fetchInvoice()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-4 rounded">
    ‚ö° ‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Zap
  </button>

  <div id="zap-result" class="mt-4 hidden">
    <p class="mb-2 text-sm text-gray-600">üì± ‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢ Lightning:</p>
    <canvas id="zap-qr" class="mx-auto"></canvas>
    <p class="text-xs text-center text-gray-400 mt-2" id="zap-pr"></p>
  </div>
</div>

<!-- ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ qrcode.js (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á npm ‡πÉ‡∏ä‡πâ‡∏ú‡πà‡∏≤‡∏ô CDN ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
  async function fetchInvoice() {
    const sats = parseInt(document.getElementById('zap-amount').value);
    const resultEl = document.getElementById('zap-result');
    const qrCanvas = document.getElementById('zap-qr');
    const prEl = document.getElementById('zap-pr');

    if (isNaN(sats) || sats < 1) {
      alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô sats ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      return;
    }

    // üîÑ LN Address ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á invoice
    const lnurl = "https://walletofsatoshi.com/.well-known/lnurlp/khunjibna"; // üëà ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ä‡πà‡∏ô ln.tips, zbd.gg, alby, nostr.pleb.dev)

    try {
      // ‡∏î‡∏∂‡∏á callback ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á invoice
      const lnurlRes = await fetch(lnurl);
      const lnData = await lnurlRes.json();

      const callback = lnData.callback;
      const amountMsat = sats * 1000;

      const invoiceRes = await fetch(`${callback}?amount=${amountMsat}`);
      const invoiceData = await invoiceRes.json();

      if (invoiceData.pr) {
        // ‡πÅ‡∏™‡∏î‡∏á QR
        resultEl.classList.remove("hidden");
        QRCode.toCanvas(qrCanvas, invoiceData.pr);
        prEl.innerText = invoiceData.pr;
      } else {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏î‡πâ üò¢");
      }
    } catch (e) {
      console.error(e);
      alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå LNURL");
    }
  }
</script>
